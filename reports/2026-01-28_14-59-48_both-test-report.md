# Hedera EVM Lab - Test Report

**Generated**: 2026-01-28 15:51:21 PST
**Report ID**: 2026-01-28_14-59-48
**Test Mode**: both

---

## Executive Summary

| Framework | Network | Passed | Failed | Total | Pass Rate |
|-----------|---------|--------|--------|-------|-----------|
| Hardhat | Local Node | 111 | 17 | 128 | 86.7% |
| Foundry | Local Node | 138 | 6 | 144 | 95.8% |
| Hardhat | Solo | 112 | 15 | 127 | 88.1% |
| Foundry | Solo | 138 | 6 | 144 | 95.8% |

---

## Gaps Analysis

### Overview

This analysis identifies key compatibility gaps between standard Ethereum tooling and Hedera's EVM implementation. Understanding these gaps is critical for developers migrating dApps or building on Hedera.

### 1. Foundry Fork Mode Limitations

**Impact**: High | **Affects**: All Foundry tests using fork mode

Foundry's fork mode cannot access Hedera's system precompiles because they are implemented at the consensus layer, not as deployed smart contracts. When forking, Foundry sees these addresses as empty accounts.

| Precompile | Address | Status in Fork Mode |
|------------|---------|---------------------|
| HTS (Hedera Token Service) | `0x167` | Not accessible |
| Exchange Rate | `0x168` | Not accessible |
| PRNG (Pseudo Random) | `0x169` | Not accessible |

**Failing Tests (6 total)**:
- `test_ConvertTinycentsToTinybars()` - Exchange Rate precompile
- `test_ConvertTinybarsToTinycents()` - Exchange Rate precompile
- `test_GetRandomSeed()` - PRNG precompile
- `test_GetRandomInRange()` - PRNG precompile
- `test_MultipleRandomSeeds()` - PRNG precompile
- `test_HederaFullIntegration()` - Uses PRNG precompile

**Workaround**: Run Foundry tests without fork mode against a live Hedera network, or use mock contracts for precompile functionality in unit tests.

### 2. Value Unit Differences (ETH vs HBAR)

**Impact**: High | **Affects**: PayableTest suite

Hedera uses tinybars (1 HBAR = 10^8 tinybars) while Ethereum uses wei (1 ETH = 10^18 wei). Tests expecting Ethereum-style value handling fail on Hedera.

| Unit | Ethereum | Hedera |
|------|----------|--------|
| Base unit | wei | tinybar |
| Main unit | 1 ETH = 10^18 wei | 1 HBAR = 10^8 tinybars |
| Conversion | N/A | 10^10 factor difference |

**Failing Tests (10+ PayableTest failures)**:
- `Should accept ETH/HBAR on deployment`
- `Should receive ETH/HBAR directly`
- `Should emit Received event`
- `Should accept deposits`
- `Should emit Withdrawn event`
- `Should withdraw to specific address`
- Value assertion mismatches: expected `10^18` but got `10^8`

**Recommendation**: Update tests to use Hedera-appropriate value assertions or create network-specific value conversion helpers.

### 3. HTS Token Association

**Impact**: Medium | **Affects**: HederaHTSTest

On Hedera, accounts must explicitly associate with tokens before receiving them. The test environment doesn't properly set up token associations for the test accounts.

**Failing Test**: `Should check token association`

**Root Cause**: Token association is a Hedera-specific requirement not present in standard ERC-20 workflows. Tests need to call `associateToken()` before token transfers.

### 4. Transaction Timing and Nonce Handling

**Impact**: Medium | **Affects**: Counter tests

Hedera has different transaction timing characteristics than local Ethereum nodes:
- Block times are ~2 seconds
- Transaction confirmation is asynchronous
- Nonce handling differs from Ethereum

**Failing Tests (Local Node)**:
- `Should increment multiple times` (timeout)
- `Should reset the counter to zero` (timeout)

**Failing Tests (Solo)**:
- `"before each" hook for "Should revert when decrementing below zero"` (nonce/timing)
- `"before each" hook for "Should emit CountChanged event"` (nonce/timing)

**Recommendation**: Increase test timeouts and add explicit transaction wait logic for Hedera networks.

### 5. Signature Verification Edge Cases

**Impact**: Low | **Affects**: PrecompileTest

Some EIP-191 signature verification tests fail, potentially due to differences in how Hedera handles message prefixing or recovery.

**Failing Test**: `Should verify message signature`

**Status**: Requires further investigation. Standard ecrecover works correctly.

### 6. Startup Time Comparison

**Local Node vs Solo Performance**:

| Metric | Local Node | Solo | Analysis |
|--------|------------|------|----------|
| Total Startup | 57.5s | 711.5s | Solo is 12.3x slower |
| First TX Ready | ~0s | 0.1s | Both near-instant after startup |
| Mirror Node Sync | N/A | ~0s | Solo mirror node syncs immediately |

**Solo Deployment Bottlenecks**:
| Component | Duration | % of Deploy Time |
|-----------|----------|------------------|
| Check node pods running | 48s | 9.6% |
| Deploy JSON RPC Relay | 40s | 8.0% |
| Consensus node start | 38s | 7.6% |
| Check all nodes ACTIVE | 23s | 4.6% |
| Check relay is ready | 22s | 4.4% |
| Explorer pod ready | 18s | 3.6% |

### Summary Matrix

| Gap Category | Local Node | Solo | Foundry | Hardhat |
|-------------|------------|------|---------|---------|
| Precompile Fork Access | - | - | FAIL | PASS |
| Value Unit Handling | FAIL | FAIL | PASS | FAIL |
| HTS Token Association | FAIL | FAIL | N/A | FAIL |
| Transaction Timing | FAIL | PASS | PASS | PARTIAL |
| Signature Verification | FAIL | FAIL | PASS | FAIL |

### Recommendations

1. **For Foundry users**: Avoid fork mode for Hedera precompile tests; use mock contracts or live network testing
2. **For Hardhat users**: Implement value conversion helpers and increase transaction timeouts
3. **For all developers**: Implement explicit token association before HTS operations
4. **For Local Node users**: Be aware of timing-related test failures; Solo provides more stable test results
5. **For CI/CD**: Consider using Solo for integration tests despite longer startup time due to better reliability

---

## Startup Timing

### Startup Timing Summary

| Metric | Local Node | Solo | Ratio |
|--------|------------|------|-------|
| Total Startup | 57.5s | 711.5s | 12.3x |
| Time to First TX | 0s | .1s | - |
| Mirror Node Sync | N/A | 0s | - |

### Local Node Breakdown

| Phase | Duration | % of Total |
|-------|----------|------------|
| Preflight | .9s | 1.5% |
| Docker Check | .7s | 1.3% |
| Start | 53.4s | 92.8% |
| Health Wait | 2.1s | 3.8% |

### Solo Breakdown

| Phase | Duration | % of Total |
|-------|----------|------------|
| Preflight | 1.1s | .1% |
| Kind Cluster | 16.0s | 2.2% |
| Deploy | 693.9s | 97.5% |
| Health Wait | 0s | 0% |

### Solo Component Breakdown (from deploy output)

| Component | Duration | % of Total |
|-----------|----------|------------|
| Check dependency: kubectl [OS: darwin, Release: 24.6.0, Arch: arm64] | .4s | 0% |
| Check dependency: helm [OS: darwin, Release: 24.6.0, Arch: arm64] | .5s | .1% |
| Check dependencies | .5s | .1% |
| Setup chart manager | 5.0s | 1.0% |
| Install MinIO Operator chart | 1.0s | .2% |
| Install cluster charts | 1.0s | .2% |
| solo cluster-ref config setup | 1.0s | .2% |
| Gossip key for node: node1 | .1s | 0% |
| Generate gossip keys | .1s | 0% |
| TLS key for node: node1 | 1.0s | .2% |
| Generate gRPC TLS Keys | 1.0s | .2% |
| solo keys consensus generate | 1.0s | .2% |
| Install chart solo-deployment | 1.0s | .2% |
| Check Node: node1, Cluster: solo-8eba1e52 | 48.0s | 9.6% |
| Check node pods are running | 48.0s | 9.6% |
| solo consensus network deploy | 50.0s | 10.0% |
| Initialize | .1s | 0% |
| Update node: node1 [ platformVersion = v0.66.0, context = kind-solo ] | 6.0s | 1.2% |
| Fetch platform software into network nodes | 6.0s | 1.2% |
| Copy configuration files | .4s | 0% |
| Set file permissions | .4s | 0% |
| Node: node1 | .8s | .1% |
| Setup network nodes | .9s | .1% |
| setup network node folders | .1s | 0% |
| solo consensus node setup | 7.0s | 1.4% |
| Identify existing network nodes | .1s | 0% |
| Start node: node1 | .1s | 0% |
| Starting nodes | .1s | 0% |
| Check network pod: node1 - status ACTIVE, attempt: 18/300 | 23.0s | 4.6% |
| Check all nodes are ACTIVE | 23.0s | 4.6% |
| Check proxy for node: node1 | 6.0s | 1.2% |
| Check node proxies are ACTIVE | 6.0s | 1.2% |
| set gRPC Web endpoint | 3.0s | .6% |
| Adding stake for node: node1 | 4.0s | .8% |
| Add node stakes | 4.0s | .8% |
| solo consensus node start | 38.0s | 7.6% |
| Initialize | .3s | 0% |
| Install mirror ingress controller | .8s | .1% |
| Deploy mirror-node | 2.0s | .4% |
| Enable mirror-node | 3.0s | .6% |
| Insert data in public.file_data | .6s | .1% |
| Seed DB data | .6s | .1% |
| Initialize | .3s | 0% |
| Install explorer | 1.0s | .2% |
| Check explorer pod is ready | 18.0s | 3.6% |
| solo explorer node add | 19.0s | 3.8% |
| Initialize | .3s | 0% |
| Deploy JSON RPC Relay | 40.0s | 8.0% |
| Check relay is ready | 22.0s | 4.4% |
| Enable port forwarding for relay node | .1s | 0% |
| Account created: 0.0.1002 | 2.0s | .4% |
| Account created: 0.0.1003 | 2.0s | .4% |
| Account created: 0.0.1004 | 2.0s | .4% |
| Account created: 0.0.1005 | 2.0s | .4% |
| Account created: 0.0.1006 | 2.0s | .4% |
| Account created: 0.0.1007 | 3.0s | .6% |
| Account created: 0.0.1008 | 3.0s | .6% |
| Account created: 0.0.1009 | 3.0s | .6% |
| Account created: 0.0.1010 | 3.0s | .6% |
| Account created: 0.0.1011 | 3.0s | .6% |
| Account created: 0.0.1012 | 3.0s | .6% |
| Account created: 0.0.1013 | 3.0s | .6% |
| Account created: 0.0.1014 | 3.0s | .6% |
| Account created: 0.0.1015 | 3.0s | .6% |
| Account created: 0.0.1016 | 3.0s | .6% |
| Account created: 0.0.1017 | 3.0s | .6% |
| Account created: 0.0.1018 | 3.0s | .6% |
| Account created: 0.0.1019 | 3.0s | .6% |
| Account created: 0.0.1020 | 3.0s | .6% |
| Account created: 0.0.1021 | 4.0s | .8% |
| Account created: 0.0.1022 | 4.0s | .8% |
| Account created: 0.0.1023 | 4.0s | .8% |
| Account created: 0.0.1024 | 4.0s | .8% |
| Account created: 0.0.1025 | 4.0s | .8% |
| Account created: 0.0.1026 | 4.0s | .8% |
| Account created: 0.0.1027 | 4.0s | .8% |
| Account created: 0.0.1028 | 4.0s | .8% |
| Account created: 0.0.1029 | 4.0s | .8% |
| Account created: 0.0.1030 | 4.0s | .8% |
| Account created: 0.0.1031 | 5.0s | 1.0% |
| Create Accounts | 5.0s | 1.0% |


---

## Environment

- **OS**: Darwin 24.6.0
- **Architecture**: arm64
- **Node.js**: v25.4.0
- **Docker**: 27.3.1
- **Foundry**: forge Version: 1.5.1-stable
- **Solo**: 
******************************* Solo *********************************************
Version			: 0.51.0
**********************************************************************************

---

## Hardhat - Local Node

### Failed Tests

```
      1) Should increment multiple times
      2) Should reset the counter to zero
      3) Should check token association
      4) Should accept ETH/HBAR on deployment
      5) Should receive ETH/HBAR directly
      6) Should emit Received event
      7) Should update totalReceived
      8) Should accept deposits
      9) Should emit Received event on deposit
      10) Should emit Withdrawn event
      11) Should withdraw to specific address
      12) Should emit Withdrawn event with recipient
      13) Should prevent old owner from withdrawing
      14) Should handle calls with data via fallback
      15) Should emit FallbackCalled event
      16) Should verify message signature
      17) Should reduce allowance after transfer
  1) Counter
  2) Counter
  3) HederaHTSTest
  4) PayableTest
  5) PayableTest
  6) PayableTest
  7) PayableTest
  8) PayableTest
  9) PayableTest
  10) PayableTest
  11) PayableTest
  12) PayableTest
  13) PayableTest
```

---

## Foundry - Local Node

### Failed Tests

```
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000169] test_HederaFullIntegration() (gas: 11767)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000168] test_ConvertTinybarsToTinycents() (gas: 10733)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000168] test_ConvertTinycentsToTinybars() (gas: 10690)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000169] test_GetRandomInRange() (gas: 10720)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000169] test_GetRandomSeed() (gas: 10517)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000169] test_MultipleRandomSeeds() (gas: 10584)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000168] test_ConvertTinybarsToTinycents() (gas: 10733)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000168] test_ConvertTinycentsToTinybars() (gas: 10690)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000169] test_GetRandomInRange() (gas: 10720)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000169] test_GetRandomSeed() (gas: 10517)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000169] test_MultipleRandomSeeds() (gas: 10584)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000169] test_HederaFullIntegration() (gas: 11767)
```

---

## Hardhat - Solo

### Failed Tests

```
      1) "before each" hook for "Should revert when decrementing below zero"
      2) "before each" hook for "Should emit CountChanged event"
      3) Should check token association
      4) Should accept ETH/HBAR on deployment
      5) Should receive ETH/HBAR directly
      6) Should emit Received event
      7) Should update totalReceived
      8) Should accept deposits
      9) Should emit Received event on deposit
      10) Should emit Withdrawn event
      11) Should withdraw to specific address
      12) Should emit Withdrawn event with recipient
      13) Should handle calls with data via fallback
      14) Should emit FallbackCalled event
      15) Should verify message signature
  1) Counter
  2) Counter
  3) HederaHTSTest
  4) PayableTest
  5) PayableTest
  6) PayableTest
  7) PayableTest
  8) PayableTest
  9) PayableTest
  10) PayableTest
  11) PayableTest
  12) PayableTest
  13) PayableTest
  14) PayableTest
  15) PrecompileTest
```

---

## Foundry - Solo

### Failed Tests

```
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000169] test_HederaFullIntegration() (gas: 11767)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000168] test_ConvertTinybarsToTinycents() (gas: 10733)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000168] test_ConvertTinycentsToTinybars() (gas: 10690)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000169] test_GetRandomInRange() (gas: 10720)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000169] test_GetRandomSeed() (gas: 10517)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000169] test_MultipleRandomSeeds() (gas: 10584)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000168] test_ConvertTinybarsToTinycents() (gas: 10733)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000168] test_ConvertTinycentsToTinybars() (gas: 10690)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000169] test_GetRandomInRange() (gas: 10720)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000169] test_GetRandomSeed() (gas: 10517)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000169] test_MultipleRandomSeeds() (gas: 10584)
[FAIL: call to non-contract address 0x0000000000000000000000000000000000000169] test_HederaFullIntegration() (gas: 11767)
```

---

*Report generated by hedera-evm-lab test framework*
